<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./KfxWebSDK/KfxWebSDK/CSS/KfxWebSDK.css">
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="./KfxWebSDK/KfxWebSDK/KfxWebSDK.js"></script>
    <!-- <script type="text/javascript" src="index.js"></script> -->
    <title>Kofax Demo App</title>
</head>
<body>
    <div class="app_container">
        <div class="text_container">
            <h1>Kofax Demo App</h1>
            <p>Select a Document Type to Scan</p>
        </div>
        <div id="button_container">
            <div class="custom-select">
                <select id="document_select">
                  <option value="0" disabled selected="selected">Select Document</option>
                  <option value="1">Check</option>
                  <option value="2">Mobile ID</option>
                  <option value="3">Passport</option>
                  <option value="4">Credit Card</option>
                  <option value="5">Pay Bill</option>
                </select>
              </div>
            <!-- <button id="captureButton">Start Camera</button> -->
        </div>
        <div id="error_message"></div>
        <div id="cameraContainer" style="display: none;"></div>
        <div id="review_container" class="review_container" style="display: none;"></div>
    </div>
    <script>

        document.addEventListener("DOMContentLoaded", function () {
            // Get default options
            KfxWebSDK.Capture.getDefaultOptions(function(defaultOptions) {
                console.info('Default options retrieved successfully:', defaultOptions);

                defaultOptions.containerId = "cameraContainer";
                defaultOptions.preference = "camera";
                defaultOptions.useVideoStream = true;
                defaultOptions.preview = true;

                // Initialize the capture control with default options
                KfxWebSDK.Capture.create(defaultOptions, function(createSuccess) {
                    console.info('Capture control created successfully.');

                    // Set additional capture options if needed
                    var captureOptions = {
                        useTargetFrameCrop: false,
                        frameAspectRatio: 0.628,
                        framePadding: 5,
                        frameCornerHeight: 15,
                        frameCornerWidth: 70,
                        frameCornerColor: '#00FF00',
                        resolution: KfxWebSDK.resolution.RES_FULL_HD,
                        downscaleSize: 2,
                        outOfFrameTransparency: 0.5,
                        showEdges: false,
                        edgesColor: '#FFFF00',
                        edgesWidth: 4,
                        enableFlashCapture: false,
                        guidanceSize: 150,
                        criteria: {
                            captureTimeout: 1700,
                            centerToleranceFraction: 0.15,
                            longAxisThreshold: 85,
                            shortAxisThreshold: 60,
                            maxFillFraction: 1.8,
                            minFillFraction: 0.65,
                            turnSkewAngleTolerance: 10,
                            pitchThreshold: 15,
                            rollThreshold: 15
                        },
                        lookAndFeel: {
                            // documentSample: 'http://example.com/images/document_sample.jpg',
                            showTapToDismissMessage: true,
                            forceCapture: 10,
                            gallery: true
                        }
                    };

                    KfxWebSDK.Capture.setOptions(captureOptions, function() {
                        console.info('Capture options set successfully.');
                    }, function(error) {
                        console.error('Error setting capture options:', error);
                    });

                }, function(error) {
                    console.error('Error creating capture control:', error);
                });

            }, function(error) {
                console.error('Error retrieving default options:', error);
            });

            // Capture image on button click
            document.getElementById('document_select').addEventListener('change', function() {
                KfxWebSDK.Capture.takePicture(function(imageData) {
                    console.info('Image captured successfully:', imageData);
                    // Display the captured image
                    var capturedImageElement = document.getElementById('capturedImage');
                    capturedImageElement.src = 'data:image/jpeg;base64,' + imageData;
                }, function(error) {
                    console.error('Error capturing image:', error);
                });
            });
        });



        // document.addEventListener("DOMContentLoaded", function () {
        //     // Get default options
        //     KfxWebSDK.Capture.getDefaultOptions(function(defaultOptions) {
        //         console.info('Default options retrieved successfully:', defaultOptions);
        //         document.getElementById('error_message').innerHTML = 'Default options retrieved successfully';

        //         // Modify default options if needed
        //         defaultOptions.containerId = "cameraContainer";
        //         defaultOptions.preference = "camera";
        //         defaultOptions.useVideoStream = true;
        //         defaultOptions.preview = true;


        //         // Initialize the capture control with default options
        //         KfxWebSDK.Capture.create(defaultOptions, function(createSuccess) {
        //             console.info('Capture control created successfully.');
        //             document.getElementById('error_message').innerHTML = 'Capture control created successfully';

        //             // Set additional capture options if needed
        //             var captureOptions = {
        //                 useTargetFrameCrop: false,
        //                 frameAspectRatio: 0.628,
        //                 framePadding: 5,
        //                 frameCornerHeight: 15,
        //                 frameCornerWidth: 70,
        //                 frameCornerColor: '#00FF00',
        //                 resolution: KfxWebSDK.resolution.RES_FULL_HD,
        //                 downscaleSize: 2,
        //                 outOfFrameTransparency: 0.5,
        //                 showEdges: false,
        //                 edgesColor: '#FFFF00',
        //                 edgesWidth: 4,
        //                 enableFlashCapture: false,
        //                 guidanceSize: 150,
        //                 criteria: {
        //                     captureTimeout: 1700,
        //                     centerToleranceFraction: 0.15,
        //                     longAxisThreshold: 85,
        //                     shortAxisThreshold: 60,
        //                     maxFillFraction: 1.8,
        //                     minFillFraction: 0.65,
        //                     turnSkewAngleTolerance: 10,
        //                     pitchThreshold: 15,
        //                     rollThreshold: 15
        //                 },
        //                 lookAndFeel: {
        //                     // documentSample: 'http://example.com/images/document_sample.jpg',
        //                     showTapToDismissMessage: true,
        //                     forceCapture: 10,
        //                     gallery: true
        //                 }
        //             };
        //             KfxWebSDK.Capture.setOptions(captureOptions, function() {
        //                 console.info('Capture options set successfully.');
        //                 document.getElementById('error_message').innerHTML = 'Capture options set successfully';

        //             }, function(error) {
        //                 console.error('Error setting capture options:', error);
        //                 document.getElementById('error_message').innerHTML = 'Error setting capture options: ' + error.message;

        //             });
        //         }, function(error) {
        //             console.error('Error creating capture control:', error);
        //             document.getElementById('error_message').innerHTML = 'Error creating capture control: ' + error.message;

        //         });
        //     }, function(error) {
        //         console.error('Error retrieving default options:', error);
        //         document.getElementById('error_message').innerHTML = 'Error retrieving default options: ' + error.message;

        //     });


        //     // Capture image on button click
        //     document.getElementById('document_select').addEventListener('change', function() {
        //         KfxWebSDK.Capture.takePicture(function(imageData) {

        //             console.info('Image captured successfully:', imageData);
        //             document.getElementById('error_message').innerHTML = 'Image captured successfully';
                    
        //             // Review Picture
        //             document.getElementById('review_container').style.display = 'block';
        //             var reviewControl = new KfxWebSDK.ReviewControl('review_container');
        //             reviewControl.review(imageData, function() {
                        
        //                 var link = document.createElement('a');
        //                 link.href = 'data:image/jpeg;base64,' + convertImageDataToBase64(imageData);
        //                 link.download = 'captured_image.jpg';
        //                 link.click();
        //                 console.log("I want it");

        //             }, function() {
                
        //                 console.log("I want to retake");
                
        //             });

        //         }, function(error) {
        //             console.error('Error capturing image:', error);
        //         });
        //     });
        // });

        // function convertImageDataToBase64(imageData) {
        //     var canvas = document.createElement("canvas");
        //     canvas.width = imageData.width;
        //     canvas.height = imageData.height;
        //     var context = canvas.getContext("2d");
        //     context.putImageData(imageData, 0, 0);
        //     var dataUrl = canvas.toDataURL("image/jpeg");
        //     var base64 = dataUrl.replace(/^data:image\/(jpeg|png|jpg);base64,/, "");
        //     context = null;
        //     canvas = null;
        //     dataUrl = null;
        //     return base64;
        // }

    </script>
</body>
</html>